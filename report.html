<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/275193; Windows/6.3.9600;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="827"/>
<h1>Report of Pratical Machine learning</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>4/22/2015 2:47 PM</i></td></tr>
</table>
</div>
<br/>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><b style="font-size: 19px;">Introduction</b><div><hr/><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">     Using devices such as </span><i style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">Jawbone Up</i><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">, </span><i style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">Nike FuelBand</i><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">, and </span><i style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">Fitbit</i><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"> it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement – a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how </span><i style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">much</i><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"> of a particular activity they do, but they rarely quantify </span><i style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">how well they do it</i><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">.</span></div><div><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">      In this project, your goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants.</span></div><div><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"><br/></span></div><div style="font-size: 19px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"><b>Data</b></span></div><div style="font-size: 19px;"><hr/><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">The training data for this project are available here: </span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><u style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"><a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv" style="box-sizing: border-box; color: rgb(3, 103, 176); text-decoration: none;">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv</a></u><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">The test data are available here: </span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv" style="box-sizing: border-box; color: rgb(3, 103, 176); text-decoration: none; font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv</a><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"/><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">The data for this project come from this source: </span><a href="http://groupware.les.inf.puc-rio.br/har" style="box-sizing: border-box; color: rgb(3, 103, 176); text-decoration: none; font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">http://groupware.les.inf.puc-rio.br/har</a><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);">. If you use the document you create for this class for any purpose please cite them as they have been very generous in allowing their data to be used for this kind of assignment. </span></div><div style="font-size: 19px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"><br/></span></div><div style="font-size: 19px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; line-height: 21px; widows: 1; background-color: rgb(255, 255, 255);"><b>View the data</b></span></div><div><hr/><span style="font-size: 19px;">     </span><span style="font-size: 15px;"> </span><span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px; widows: 1;">Load the training data and testing data into R console, naming training and testing.</span></div><div style="widows: 1;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="font-size: 14px; line-height: 21px;">Use str() function, we can  see that there are 19622 observations in the training set, each has 160 features. And there are 20 observations in the testing set.</span></font></div><div style="widows: 1;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="font-size: 14px; line-height: 21px;">     Using names() function, we can take a look at the features, and we can know that the class label is the last feature ,&quot;classe&quot;, which has 5 levels, namely &quot;A&quot; through &quot;E&quot;.</span></font></div><div style="widows: 1;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="font-size: 14px; line-height: 21px;">     Since there are too many features, we may need to remove some useless features. That is to say, we need to do some data cleaning before use it.</span></font></div><div style="widows: 1;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="font-size: 14px; line-height: 21px;">     Further, since we need to estimate the out sample error, we should split the training set into a train set and a validation set. Then, we can use the train set to build our model, and use the validation set to evaluate the model.</span></font></div><div style="widows: 1;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="font-size: 14px; line-height: 21px;"><br/></span></font></div><div style="widows: 1; font-size: 19px;"><font color="#333333" face="Helvetica Neue, Helvetica, Arial, sans-serif"><span style="line-height: 21px;"><b>Data cleaning</b></span></font></div><div style="widows: 1; font-size: 19px;"><hr/><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px;">     In this step, we will remove some useless observations and useless features.</span></div><div style="widows: 1; font-size: 19px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px;">First, remove columns that have NA values.</span></div><div style="widows: 1; font-size: 19px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px;"><br/></span></div><div style="widows: 1; font-size: 15px;"><font face="Calibri Light">&gt; training &lt;- training[, colSums(is.na(training)) == 0]<br/>
&gt; testing &lt;- testing[, colSums(is.na(testing)) == 0]</font></div><div style="widows: 1; font-size: 15px;"><font face="Calibri Light"><br/></font></div>
     After that, we can retain 93 features.<br/>
     Then, we remove features that do no contribution to the accelerometer measurements.Such as feature &quot;X&quot;, &quot;raw_timestamp_part_1&quot;,<br/>
&quot;raw_timestamp_part_2&quot;,&quot;new_window&quot;  and so on.<br/>
     At last, we get 19622 observations and 53 features, and there are no NA value.
<div style="widows: 1; font-size: 15px;"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 21px;"><br/></span></div><div style="widows: 1; font-size: 15px;"><br/></div><div style="widows: 1; font-size: 19px;"><b>Data Splitting</b></div><div style="widows: 1;"><hr style="font-size: 19px;"/><span style="font-size: 15px;">     We should split the training set into a train set and a validation set. The split ratio is set to be 0.7. That is to say,  we use 70% of the training set as a train set, and 30% of the training set as a validation set.</span></div><div style="widows: 1;"><span style="font-size: 15px;">     The seed is set as 144.</span></div><div style="widows: 1;"><span style="font-size: 15px;"><br/></span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="widows: 1;"><span>&gt; set.seed(144)</span></div><div style="widows: 1;"><span>&gt; library(caTools)</span></div><div style="widows: 1;"><span>&gt; spl = sample.split(training$classe, SplitRatio = 0.7)</span></div><div style="widows: 1;"><span>&gt; train = subset(training, spl ==TRUE)</span></div><div style="widows: 1;"><span>&gt; validation = subset(training, spl == FALSE)</span></div></blockquote><div style="widows: 1;"><span style="font-size: 15px;"><br/></span></div><div style="widows: 1;"><span style="font-size: 15px;">Then, the train set has 13735 observations. The validation set has 5887 observations.</span></div><div style="widows: 1;"><span style="font-size: 15px;"><br/></span></div><div style="widows: 1; font-size: 19px;"><b>Create Model</b></div><div style="widows: 1; font-size: 19px;"><hr/></div><div style="widows: 1;">We use Random Forest algorithm to train the model, since RF is one of the most robust and accurate classification algorithm,  and we use a 4 fold CV to prevent overfitting.</div><div style="widows: 1;">     The procedure is as this:</div><div style="widows: 1;">&gt; controlRF &lt;- trainControl(method = &quot;cv&quot;, 5)<br/>
&gt; modelRF &lt;- train(classe ~ ., data = train, method = &quot;rf&quot;, trControl = controlRF, ntree = 200)<br/>
&gt; modelRF<br/>
Random Forest<br/><br/>
Then we get the result:<br/><br/>
13735 samples<br/>
   52 predictor<br/>
    5 classes: 'A', 'B', 'C', 'D', 'E'<br/><br/>
No pre-processing<br/>
Resampling: Cross-Validated (5 fold)<br/><br/>
Summary of sample sizes: 10987, 10989, 10987, 10988, 10989<br/><br/>
Resampling results across tuning parameters:<br/><br/>
  mtry  Accuracy   Kappa      Accuracy SD  Kappa SD  <br/>
   2    0.9890064  0.9860932  0.001999337  0.002527211<br/>
  27    0.9903172  0.9877514  0.002617216  0.003308718<br/>
  52    0.9785950  0.9729210  0.003226834  0.004069693<br/><br/>
Accuracy was used to select the optimal model using  the largest value.<br/>
The final value used for the model was mtry = 27. </div><div style="widows: 1;"><br/></div><div style="widows: 1;">Use the validation set to estimate the out sample error. We can get :</div><div style="widows: 1;"><br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="widows: 1;">&gt; predValidation &lt;- predict(modelRF, validation)</div><div style="widows: 1;">&gt; confusionMatrix(validation$classe, predValidation)</div><div style="widows: 1;">Confusion Matrix and Statistics</div><div style="widows: 1;"><br/></div><div style="widows: 1;">          Reference</div><div style="widows: 1;">Prediction    A    B    C    D    E</div><div style="widows: 1;">         A 1671    2    1    0    0</div><div style="widows: 1;">         B    6 1127    6    0    0</div><div style="widows: 1;">         C    0    3 1018    6    0</div><div style="widows: 1;">         D    0    3   10  952    0</div><div style="widows: 1;">         E    0    0    1    2 1079</div><div style="widows: 1;"><br/></div><div style="widows: 1;">Overall Statistics</div><div style="widows: 1;">                                         </div><div style="widows: 1;">               Accuracy : 0.9932         </div><div style="widows: 1;">                 95% CI : (0.9908, 0.9951)</div><div style="widows: 1;">    No Information Rate : 0.2849         </div><div style="widows: 1;">    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      </div><div style="widows: 1;">                                         </div><div style="widows: 1;">                  Kappa : 0.9914         </div><div style="widows: 1;">Mcnemar's Test P-Value : NA             </div><div style="widows: 1;"><br/></div><div style="widows: 1;">Statistics by Class:</div><div style="widows: 1;"><br/></div><div style="widows: 1;">                     Class: A Class: B Class: C Class: D Class: E</div><div style="widows: 1;">Sensitivity            0.9964   0.9930   0.9826   0.9917   1.0000</div><div style="widows: 1;">Specificity            0.9993   0.9975   0.9981   0.9974   0.9994</div><div style="widows: 1;">Pos Pred Value         0.9982   0.9895   0.9912   0.9865   0.9972</div><div style="widows: 1;">Neg Pred Value         0.9986   0.9983   0.9963   0.9984   1.0000</div><div style="widows: 1;">Prevalence             0.2849   0.1928   0.1760   0.1631   0.1833</div><div style="widows: 1;">Detection Rate         0.2838   0.1914   0.1729   0.1617   0.1833</div><div style="widows: 1;">Detection Prevalence   0.2844   0.1935   0.1745   0.1639   0.1838</div><div style="widows: 1;">Balanced Accuracy      0.9979   0.9952   0.9904   0.9945   0.9997</div></blockquote>
From the overall statistics we can know that the accuracy is 0.9932, so that the out sample error is 1 - 0.9932 = 0.0068.
<div><br/></div><div><span style="font-size: 19px;"><b>predict on the test set</b></span></div><div><hr/>
     <span style="font-size: 15px;">So far we know that our model performs well on the validation set, thus we can use it to predict on the testing set. And before we conduct the prediction , we should remove the &quot;problem_id&quot; feature from the testing set.</span></div><div><span style="font-size: 15px;"><br/></span></div><div>&gt; result &lt;- predTesting &lt;- predict(modelRF, testing)<br/>
&gt; result<br/>
[1] B A B A A E D B A A B C B A E E A B B B<br/>
Levels: A B C D E</div><div><br/></div><div><span style="font-size: 15px;">By far, we have get the prediction of the 20 testing observations.<br/></span><div style="widows: 1;"><br/></div></div></span>
</div></body></html> 